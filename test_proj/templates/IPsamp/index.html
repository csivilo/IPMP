<!DOCTYPE HTML>
{% load staticfiles %}
<html>
    <title>IPMP</title>
    <head>
        <link rel="stylesheet" href='{%  static "js/webix/codebase/webix.css" %}' type="text/css">
        <script src="{%  static 'js/webix/codebase/webix.js' %}" type="text/javascript"></script>
        <script src="{%  static 'js/jquery-3.0.0.js' %}" type="text/javascript">

        </script>
    </head>
    
    <body>
    <script type="text/javascript" charset="utf-8">


            var data_points = [
                { id: 1, time_input: null, conc_input:null},
                { id: 2, time_input: null, conc_input:null},
                { id: 3, time_input: null, conc_input:null},
                { id: 4, time_input: null, conc_input:null},
                { id: 5, time_input: null, conc_input:null},
                { id: 6, time_input: null, conc_input:null},
                { id: 7, time_input: null, conc_input:null},
                { id: 8, time_input: null, conc_input:null},
                { id: 9, time_input: null, conc_input:null}
            ]
            console.log(data_points);

        webix.ui({
            rows:[
               {view: "toolbar", id:"toolbar", elements:[
               {view:"button", value:"File", width:80 /*, click:file_options*/},
               {view:"button", value:"Disclaimer", width:80 /* ,click:ipmp_disclaim*/},
               {view:"button", value:"Help", width:80 /* ,click:ipmp_help}*/},
               ]},
                {cols:[
                    {rows:[
                        {view: "datatable",
                        id: "input_table",
                        columns: [
                           {id: "time_input", editor: "text", header: "Time", width: 100},
                           {id: "conc_input", editor: "text", header: "Conc.", width: 100}],
                        editable: true,
                        height:250,
                        width:200,

                        data: data_points,
                        },

                        {view: "toolbar", id:"toolbar", elements:[
                            {view:"button", value:"Compute", width:80 , click:"computeData()"},
                            {view:"button", value:"Plot Data", width:80 , click:"plotData(); printData()"},
                        ]},
                        {rows:[
						    {view:"form", id:"slider_input", height: 160,elements:[
                                { view:"slider",  height: 20, type:"alt", min:0, max:5, label:"N0(0-5)", value:"0", name:"s1"},
                                { view:"slider", height: 20, type:"alt", min:0, max:9, label:"NMax(0-9)", value:"0", name:"s2"},
                                { view:"slider", height: 20, type:"alt", min:0, max:5, label:"Rate(0-5)", value:"0", name:"s3"},
                                { view:"slider", height: 20, type:"alt",  label:"Time", value:"0", name:"s4"},
                                { view:"slider", height: 20, type:"alt",  label:"M", value:"0", name:"s5"},
						    ]},
						    {view:"form", id:"insert_input", elements:[{
								type:"clean",
								cols:[
									{ view:"button", type: "form", id:"slider_set", label:"Set values", click:"set(); getData()",
                                        align:"right", width: 90,},
									{ view:"button", id:"slider_get", label:"Get values", click:"get(); getData()",
                                        align:"left", width: 90, }
								]},
							    {view: "fieldset", label:"Data", body:{
								    rows:[
									    { view:"text", id: "nO", label:"N0", value:"0", name:"s1"},
									    { view:"text", id: "nmax", label:"NMax", value:"0", name:"s2"},
									    { view:"text", id: "rate", label:"Rate", value:"0", name:"s3"},
                                        { view:"text", id: "time", label:"Time", value:"0", name:"s4"},
                                        { view:"text", id: "m", label:"M", value:"0", name:"s5"},
								    ]
							    }}
						    ]}
                        ]}
                    ]},
                    {rows:[
                        {view:"chart",
                        id: "data_chart",
                        type:"scatter",
                        scale: "logarithmic",
                        value:"#conc_input#",
                        xValue: "#time_input#",
                        origin: 0,
                        yAxis:{
                            title:"Log Concentration of Bacteria",
                        },
                        xAxis:{
                            title:"Time (h)"
                        },
                        item:{
                            radius:5,
                            borderColor:"#f38f00",
                            borderWidth:1,
                            color:"#ff9600",
                            type:"d",
                            shadow:true
                        },
                        data: data_points,
                        isVisible:false
                        },


                        {view: "datatable",
                            id:"output_table",
                        columns: [
                           {id: "export", header: "Export Data"},
                        ],
                        editable: false,
                        }
                    ]}

                ]}
            ]
        });

        function set(){
            var data = $$('insert_input').getValues();
            $$('slider_input').setValues(data);
        }

        function get() {
            var data = $$('slider_input').getValues();
            $$('insert_input').setValues(data);
        }

        function computeData(){
            var data_set = getData();

            $.ajax({
                type: "POST",
                url: 'data/',
                dataType: "json",
                data: {
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                    nO: data_set[0],
                    nmax: data_set[1],
                    rate: data_set[2],
                    time: data_set[3],
                    m: data_set[4],
                },
                success: function(json) {
                    var data = json;
                    updateData(data)

                },


            });
        }

        function updateData(new_data) {
            data_points = []
            console.log(data_points);
            for (var i = 0; i < new_data["plot"].length; i++) {
                data_points.push(new_data["plot"][i])
            };
            console.log(data_points);

            plotData();
        }

        function getData() {
            //creates new array and pushes each value in the slider to the array
            //the array hold the data in the same order:
                //NO, NMax, Rate, Time, and M

            var input_data = [];
            input_data.push( $$('slider_input').getValues().s1); //NO
            input_data.push( $$('slider_input').getValues().s2); //NMax
            input_data.push( $$('slider_input').getValues().s3); //Rate
            input_data.push( $$('slider_input').getValues().s4); //Time
            input_data.push( $$('slider_input').getValues().s5); //M


            return input_data
        }



        //will refresh the scatter plot with the updated data passed in via the datatable
        function plotData(){
            $$('data_chart').refresh();
            $$('data_chart').show();
            console.log(data_points);
        }

        function printData(){
            $$('output_table').add(data_points);
        }

    </script>
    </body>
</html>
